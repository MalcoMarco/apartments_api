import{a as s}from"./toastr-OoYBPmKn.js";Alpine.data("planPago",()=>({id:null,nombre_proyecto:"SAIKO BUSINESS & CORPORATE CENTER",descripcion:"LOCAL COMERCIAL",metros_construccion:40,metros_solar:"",piso:"",modulo:"",parqueo:"",mantenimiento:"",fecha_entrega:new Date().toISOString().split("T")[0],valor_propiedad:"7000000",reserva:"2000",inicial:"",porcentaje_saldo:15,monto_cuota_mensual:"",porcentaje_monto:30,contra_entrega:"",numero_cuotas:20,lista_cuotas:[{numero:0,fecha:new Date().toISOString().split("T")[0],monto:"000.00"}],asesor:"",cliente:"",fecha_envio_plan_pago:new Date().toISOString().split("T")[0],initData(e){e&&(this.asesor=e.asesor,this.cliente=e.cliente,this.contra_entrega=e.contra_entrega,this.descripcion=e.descripcion,this.fecha_entrega=e.fecha_entrega,this.fecha_envio_plan_pago=e.fecha_envio_plan_pago,this.id=e.id,this.inicial=e.inicial,this.lista_cuotas=JSON.parse(e.lista_cuotas),this.mantenimiento=e.mantenimiento,this.metros_construccion=e.metros_construccion,this.metros_solar=e.metros_solar,this.modulo=e.modulo,this.monto_cuota_mensual=e.monto_cuota_mensual,this.nombre_proyecto=e.nombre_proyecto,this.numero_cuotas=e.numero_cuotas,this.parqueo=e.parqueo,this.piso=e.piso,this.porcentaje_monto=e.porcentaje_monto,this.porcentaje_saldo=e.porcentaje_saldo,this.reserva=e.reserva,this.valor_propiedad=e.valor_propiedad)},calcularcuotas(){const e={valor_propiedad:this.valor_propiedad,reserva:this.reserva,porcentaje_saldo:this.porcentaje_saldo,porcentaje_monto:this.porcentaje_monto,numero_cuotas:this.numero_cuotas,fecha_entrega:this.fecha_entrega};s.post("/api/calcular-cuotas",e).then(t=>{console.log(t.data),this.inicial=t.data.inicial,this.monto_cuota_mensual=t.data.monto_cuota_mensual,this.contra_entrega=t.data.contra_entrega,this.lista_cuotas=t.data.lista_cuotas})},formatFecha(e){const t={day:"2-digit",month:"2-digit",year:"numeric"};return new Intl.DateTimeFormat("es-ES",t).format(new Date(e))},formatCurrency(e){const t={style:"currency",currency:"USD"};return new Intl.NumberFormat("en-US",t).format(e)},guardarPlanPago(){const e={nombre_proyecto:this.nombre_proyecto,descripcion:this.descripcion,metros_construccion:this.metros_construccion,metros_solar:this.metros_solar,piso:this.piso,modulo:this.modulo,parqueo:this.parqueo,mantenimiento:this.mantenimiento,fecha_entrega:this.fecha_entrega,valor_propiedad:this.valor_propiedad,reserva:this.reserva,inicial:this.inicial,porcentaje_saldo:this.porcentaje_saldo,monto_cuota_mensual:this.monto_cuota_mensual,porcentaje_monto:this.porcentaje_monto,contra_entrega:this.contra_entrega,numero_cuotas:this.numero_cuotas,lista_cuotas:JSON.stringify(this.lista_cuotas),asesor:this.asesor,cliente:this.cliente,fecha_envio_plan_pago:this.fecha_envio_plan_pago};this.id?this.actualizaPlan(e):this.crearPlan(e)},crearPlan(e){s.post("/dashboard/plan-pago",e).then(t=>{toastr.success(t.data.message),this.redirectPage()}).catch(t=>{if(console.log(t.response.data.errors),t.status===422){let o="";for(const a in t.response.data.errors)o+=t.response.data.errors[a]+"<br>";toastr.error(o)}else toastr.error(t.response.data.message)})},actualizaPlan(e){s.put(`/dashboard/plan-pago/${this.id}`,e).then(t=>{toastr.success(t.data.message),this.redirectPage()}).catch(t=>{if(console.log(t.response.data.errors),t.status===422){let o="";for(const a in t.response.data.errors)o+=t.response.data.errors[a]+"<br>";toastr.error(o)}else toastr.error(t.response.data.message)})},redirectPage(){setTimeout(()=>{window.location.href="/dashboard/plan-pago-list"},2e3)},descargarPreview(){const e={nombre_proyecto:this.nombre_proyecto,descripcion:this.descripcion,metros_construccion:this.metros_construccion,metros_solar:this.metros_solar,piso:this.piso,modulo:this.modulo,parqueo:this.parqueo,mantenimiento:this.mantenimiento,fecha_entrega:this.fecha_entrega,valor_propiedad:this.valor_propiedad,reserva:this.reserva,inicial:this.inicial,porcentaje_saldo:this.porcentaje_saldo,monto_cuota_mensual:this.monto_cuota_mensual,porcentaje_monto:this.porcentaje_monto,contra_entrega:this.contra_entrega,numero_cuotas:this.numero_cuotas,lista_cuotas:JSON.stringify(this.lista_cuotas),asesor:this.asesor,cliente:this.cliente,fecha_envio_plan_pago:this.fecha_envio_plan_pago};s.post("/dashboard/plan-pago-preview",{planpago:e},{responseType:"blob"}).then(t=>{const o=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=o,a.setAttribute("download","plan_pago_preview.pdf"),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(o)}).catch(t=>{console.log(t.response.data.errors),toastr.error("Error al generar la vista previa del plan de pago.")})}}));Alpine.data("listPlanPagos",()=>({items:{data:[],links:[]},page:1,per_page:100,initData(){this.getData()},getData(){s.get(`/dashboard/api/plan-pago-list?page=${this.page}&per_page=${this.per_page}`).then(e=>{this.items=e.data})},formatFecha(e){const t={day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"};return new Intl.DateTimeFormat("es-ES",t).format(new Date(e))},deleteItem(e){}}));
